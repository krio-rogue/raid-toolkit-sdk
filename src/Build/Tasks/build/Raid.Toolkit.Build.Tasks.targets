<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003" InitialTargets="RTK_SetDefaults">
    <PropertyGroup>
        <MSBuildAllProjects>$(MSBuildAllProjects);$(MSBuildThisFileFullPath)</MSBuildAllProjects>
        <OutputAssemblyName>Raid.Interop</OutputAssemblyName>
        <OutputAssemblyFile>$(OutputAssemblyName).dll</OutputAssemblyFile>
    </PropertyGroup>

    <Import Project="Raid.Toolkit.Build.Tasks.Common.props" />

    <ItemGroup>
        <AvailableItemName Include="RTKExtensionManifest">
            <Targets>GenerateRTKManifest</Targets>
        </AvailableItemName>
    </ItemGroup>

    <Target Name="RTK_SetDefaults">
        <PropertyGroup>
            <GenerateInterop Condition=" '$(GenerateInterop)' == '' and '$(TargetExt)' != '.dll' ">false</GenerateInterop>
            <!-- 
            <CoreCompileDependsOn>
                GenerateRTKInteropAssembly;
                $(CoreCompileDependsOn)
            </CoreCompileDependsOn> -->

            <ResolveAssemblyReferencesDependsOn>
                GenerateRTKInteropAssembly;
                $(ResolveAssemblyReferencesDependsOn)
            </ResolveAssemblyReferencesDependsOn>
        </PropertyGroup>
    </Target>

    <Target Name="PackageExtension" AfterTargets="PostBuildEvent" Condition=" '$(PackageRTKExtension)' == 'true' ">
        <Exec Condition=" '$(GenerateInterop)' != 'false' " Command="$(RaidToolkitSdkCliPath) package &quot;@(RTKExtensionManifest -> '%(FullPath)')&quot; --out-file &quot;$(OutDir)\$(AssemblyName).rtkx&quot; --out-dir &quot;$(OutDir)&quot; --cache-dir &quot;$(RTKInteropCacheDir)&quot;" />
    </Target>

    <Target Name="GenerateRTKInteropAssembly">
        <MakeDir Directories="$(IntermediateOutputPath)" />

        <Exec Condition=" '$(GenerateInterop)' != 'false' " Command="$(RaidToolkitSdkCliPath) codegen &quot;@(RTKExtensionManifest -> '%(FullPath)')&quot; --out-asm &quot;$(IntermediateOutputPath)$(OutputAssemblyFile)&quot; --out-dir &quot;$(OutDir)&quot; --cache-dir &quot;$(RTKInteropCacheDir)&quot;" />

        <ItemGroup>
            <EmbeddedResource Include="@(RTKExtensionManifest)" LogicalName="PackageManifest">
                <CopyToOutputDirectory>Never</CopyToOutputDirectory>
            </EmbeddedResource>
        </ItemGroup>
    </Target>

    <ItemGroup>
        <Reference Include="$(OutputAssemblyName)">
            <HintPath>$(IntermediateOutputPath)$(OutputAssemblyFile)</HintPath>
            <Private>False</Private>
            <SpecificVersion>False</SpecificVersion>
            <CopyLocal>False</CopyLocal>
        </Reference>
    </ItemGroup>

</Project>